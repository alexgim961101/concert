# Redis 영속성 설정
# 대기열 데이터 유실 방지를 위한 AOF + RDB 설정

# =============================================================================
# AOF (Append-Only File) 설정 - 주요 영속성 메커니즘
# =============================================================================

# AOF 활성화
appendonly yes

# fsync 정책: everysec (1초마다 동기화, 성능/안정성 균형)
# - always: 매 명령마다 (가장 안전, 가장 느림)
# - everysec: 1초마다 (권장, 최악의 경우 1초 데이터 유실)
# - no: OS에 맡김 (가장 빠름, 가장 위험)
appendfsync everysec

# AOF rewrite 중에도 fsync 수행 (데이터 안정성 우선)
no-appendfsync-on-rewrite no

# AOF 파일이 이전 크기 대비 100% 증가 시 rewrite
auto-aof-rewrite-percentage 100

# AOF 파일 최소 크기 (이 크기 이하면 rewrite 하지 않음)
auto-aof-rewrite-min-size 64mb

# =============================================================================
# RDB (Snapshot) 설정 - 백업용
# =============================================================================

# RDB 스냅샷 조건
# save <seconds> <changes>
save 900 1      # 15분 내 1건 이상 변경
save 300 10     # 5분 내 10건 이상 변경
save 60 10000   # 1분 내 10000건 이상 변경

# RDB 저장 실패 시 쓰기 중단 (데이터 손실 방지)
stop-writes-on-bgsave-error yes

# RDB 파일 압축
rdbcompression yes

# RDB 체크섬
rdbchecksum yes

# =============================================================================
# 일반 설정
# =============================================================================

# 데이터 저장 디렉토리
dir /data

# 로그 레벨
loglevel notice

# 최대 메모리 정책 (대기열은 TTL로 관리되므로 noeviction 권장)
# maxmemory-policy noeviction
